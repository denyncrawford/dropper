function Dropper(a){var b=a.username,c=a.appName,d=a.password,e=a.apiKey,f=a.connect,g=f.domain||window.location.host,h=f.path||"/dropper",i=a.logs||!1,j="http://",k="ws://",l=f.secure||!1;if(!0==l&&(j="https://",k="wss://"),"/"!=h[0]&&(h="/"+h),!e||0==e.length)return void console.error("Please provide any apiKey in the options to connect the Droppet instance");var m,n=new WebSocket(k+g+h),o=new EventEmitter,p=!1,q=!1,r=[];fetch(j+g+h,{method:"GET",mode:"cors",headers:{Authorization:e,"Content-Type":"application/json"}}).then(a=>a.json()).then(a=>{a.bool?(p=!1,q=!0):(n&&n.close(4001,"Unauthorized"),console.error(a.message),p=!0,q="fail")});var s=function(a){!0==q&&o.emit("message",a.data)},t=function(a){var b=setInterval(()=>{if(!0==q){if(o.emit("open",a.data),0<r.length){for(var c=0;c<r.length;c++)n.send(r[c]);r=[]}m=setInterval(()=>{n.send("dropper:prevent")},25e3),clearInterval(b)}else"fail"==q&&clearInterval(b)},100)},u=function(a){p=!0;var b=a.code;if(clearInterval(m),1002==b||4001==b||1e3==b)o.emit("close",a);else{n=null;var c=setInterval(()=>{navigator.onLine&&p?(n=new WebSocket(k+g+h),n.onmessage=s,n.onopen=t,n.onclose=u,p=!1,clearInterval(c)):console.log("Dropper is trying to reconnect...")},100)}};n.onmessage=s,n.onopen=t,n.onclose=u,this.emit=function(a,b){"undefined"==typeof b?(b=a,a=null,n.send(b)):p?(r.push(JSON.stringify({event:a,message:b})),console.error("The connection is closed, but Dropper added your data in the queue to be sent when reconnecting.")):!0==q&&n.send(JSON.stringify({event:a,message:b}))},this.close=function(a,b){n.close(a||1e3,b||"")},this.on=function(a,b){"open"===a?o.on("open",function(a){return b(a)}):"message"===a?o.on("message",function(a){return isJson(a)&&(a=JSON.parse(a)),a.channel?void 0:b(a)}):"close"===a?o.on("close",function(a){return b(a)}):o.on("message",function(c){return isJson(c)&&(c=JSON.parse(c)),c.event?a==c.event?c.channel?void 0:b(c.message,c):void 0:b("Not event detected, try the default 'message' event to read raw data.")})},this.subscribe=function(a){return{bind:function(b,c){o.on("message",function(d){return isJson(d)&&(d=JSON.parse(d)),d.channel?d.channel==a?d.event==b?c(d.message):void 0:void 0:void 0})}}},this.trigger=function(a,b,c){return"undefined"==typeof a?console.log("Please provide a channel to use the trigger method."):void("undefined"==typeof c?(c=b,b=null,n.send(JSON.stringify({channel:a,message:c}))):n.send(JSON.stringify({channel:a,event:b,message:c})))}}function isJson(a){try{JSON.parse(a)}catch(a){return!1}return!0}var indexOf="function"==typeof Array.prototype.indexOf?function(a,b){return a.indexOf(b)}:function(a,b){for(var c=0,d=a.length,e=-1,f=!1;c<d&&!f;)a[c]===b&&(e=c,f=!0),c++;return e};var EventEmitter=function(){this.events={}};EventEmitter.prototype.on=function(a,b){"object"!=typeof this.events[a]&&(this.events[a]=[]),this.events[a].push(b)},EventEmitter.prototype.removeListener=function(a,b){var c;"object"==typeof this.events[a]&&(c=indexOf(this.events[a],b),-1<c&&this.events[a].splice(c,1))},EventEmitter.prototype.emit=function(a){var b,c,d,e=[].slice.call(arguments,1);if("object"==typeof this.events[a])for(c=this.events[a].slice(),d=c.length,b=0;b<d;b++)c[b].apply(this,e)},EventEmitter.prototype.once=function(a,b){this.on(a,function c(){this.removeListener(a,c),b.apply(this,arguments)})};
