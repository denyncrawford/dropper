function Dropper(a){var b=a.username,c=a.appName,d=a.password,e=a.apiKey,f=a.connect,g=f.domain||window.location.host,h=f.path||"/dropper",i=a.logs||!1,j="http://",k="ws://",l=f.secure||!1;if(!0==l&&(j="https://",k="wss://"),"/"!=h[0]&&(h="/"+h),!e||0==e.length)return void console.error("Please provide any apiKey in the options to connect the Droppet instance");var m,n=new EventEmitter,o=!1,p=[];fetch(j+g+h,{method:"GET",mode:"cors",headers:{Authorization:e,"Content-Type":"application/json"}}).then(a=>a.json()).then(a=>{if(!a.bool)b&&b.close(4001,"Unauthorized"),console.error(a.message),o=!0;else{var b=new WebSocket(k+g+h);o=!1;var c=function(a){n.emit("message",a.data)},d=function(a){if(n.emit("open",a.data),0<p.length){for(var c=0;c<p.length;c++)b.send(p[c]);p=[]}m=setInterval(()=>{b.send("dropper:prevent")},25e3)},e=function(a){o=!0;var f=a.code;if(clearInterval(m),1002==f||4001==f||1e3==f)n.emit("close",a);else{b=null;var i=setInterval(()=>{navigator.onLine&&o?(b=new WebSocket(k+g+h),b.onmessage=c,b.onopen=d,b.onclose=e,o=!1,clearInterval(i)):console.log("Dropper is trying to reconnect...")},100)}};b.onmessage=c,b.onopen=d,b.onclose=e,this.emit=function(a,c){"undefined"==typeof c?(c=a,a=null,b.send(c)):o?(p.push(JSON.stringify({event:a,message:c})),console.error("The connection is closed, but Dropper added your data in the queue to be sent when reconnecting.")):b.send(JSON.stringify({event:a,message:c}))},this.close=function(a,c){b.close(a||1e3,c||"")},this.on=function(a,b){"open"===a?n.on("open",function(a){return b(a)}):"message"===a?n.on("message",function(a){return isJson(a)&&(a=JSON.parse(a)),a.channel?void 0:b(a)}):"close"===a?n.on("close",function(a){return b(a)}):n.on("message",function(c){return isJson(c)&&(c=JSON.parse(c)),c.event?a==c.event?c.channel?void 0:b(c.message,c):void 0:b("Not event detected, try the default 'message' event to read raw data.")})},this.subscribe=function(a){return{bind:function(b,c){n.on("message",function(d){return isJson(d)&&(d=JSON.parse(d)),d.channel?d.channel==a?d.event==b?c(d.message):void 0:void 0:void 0})}}},this.trigger=function(a,c,d){return"undefined"==typeof a?console.log("Please provide a channel to use the trigger method."):void("undefined"==typeof d?(d=c,c=null,b.send(JSON.stringify({channel:a,message:d}))):b.send(JSON.stringify({channel:a,event:c,message:d})))}}})}function isJson(a){try{JSON.parse(a)}catch(a){return!1}return!0}var indexOf="function"==typeof Array.prototype.indexOf?function(a,b){return a.indexOf(b)}:function(a,b){for(var c=0,d=a.length,e=-1,f=!1;c<d&&!f;)a[c]===b&&(e=c,f=!0),c++;return e};var EventEmitter=function(){this.events={}};EventEmitter.prototype.on=function(a,b){"object"!=typeof this.events[a]&&(this.events[a]=[]),this.events[a].push(b)},EventEmitter.prototype.removeListener=function(a,b){var c;"object"==typeof this.events[a]&&(c=indexOf(this.events[a],b),-1<c&&this.events[a].splice(c,1))},EventEmitter.prototype.emit=function(a){var b,c,d,e=[].slice.call(arguments,1);if("object"==typeof this.events[a])for(c=this.events[a].slice(),d=c.length,b=0;b<d;b++)c[b].apply(this,e)},EventEmitter.prototype.once=function(a,b){this.on(a,function c(){this.removeListener(a,c),b.apply(this,arguments)})};
